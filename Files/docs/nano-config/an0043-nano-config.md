# RT-Thread Nano Configuration

The configuration of RT-Thread Nano is done in `rtconfig.h` by enabling or disabling certain features through macro definitions. The following explanations provide details on the macro definitions in this configuration file.

## Basic Configuration

1. Set the maximum system priority, ranging from 8 to 256, with a default value of 32, which can be modified.

    ```c
    #define RT_THREAD_PRIORITY_MAX  32
    ```

2. Set the RT-Thread operating system ticks, indicating how many ticks per second. The default value is 1000, representing a tick length of 1ms. Common values are 100 or 1000. A faster tick rate increases system overhead.

    ```c
    #define RT_TICK_PER_SECOND  1000
    ```

3. Specify the number of bytes for alignment, with a default of 4. Use `ALIGN(RT_ALIGN_SIZE)` for byte alignment.

    ```c
    #define RT_ALIGN_SIZE   4
    ```

4. Set the maximum length of object names, with a default of 8 characters, typically not needing modification.

    ```c
    #define RT_NAME_MAX    8
    ```

5. Enable automatic initialization of components. This macro should be defined to use the automatic initialization feature.

    ```c
    #define RT_USING_COMPONENTS_INIT
    ```

6. Enable `RT_USING_USER_MAIN` to activate the user_main feature, which is required to call RT-Thread's startup code. The stack size of the main thread can be modified.

    ```c
    #define RT_USING_USER_MAIN
    #define RT_MAIN_THREAD_STACK_SIZE     512
    ```

## Kernel Debugging Configuration

Define the `RT_DEBUG` macro to enable debug mode. If system debugging is enabled, system LOG logs can be printed after implementation. Open this during code development and debugging to help locate issues and close it when releasing the code.

```c
//#define RT_DEBUG                 // Disable debug

#define RT_DEBUG_INIT 0            // Enable component initialization debugging configuration. Set to 1 to print the names of automatically initialized functions.

//#define RT_USING_OVERFLOW_CHECK  // Disable stack overflow check
```

## Hook Function Configuration

Set whether to use hook functions, disabled by default.

```c
//#define RT_USING_HOOK                         // Enable system hook function

//#define RT_USING_IDLE_HOOK                    // Enable idle thread hook function
```

## Software Timer Configuration

Set whether to enable software timers and related parameters. Disabled by default.

```c
#define RT_USING_TIMER_SOFT       0             // Disable software timer feature, set to 1 to enable
#if RT_USING_TIMER_SOFT == 0
#undef RT_USING_TIMER_SOFT
#endif

#define RT_TIMER_THREAD_PRIO        4           // Set the priority of the software timer thread, default is 4

#define RT_TIMER_THREAD_STACK_SIZE  512         // Set the stack size of the software timer thread, default is 512 bytes
```

## IPC Configuration

The system supports various IPC mechanisms: semaphore, mutex, event, mailbox, and message queue. Enable or disable the use of each IPC by defining the corresponding macros.

```c
#define RT_USING_SEMAPHORE         // Enable semaphore usage, enabled by default

//#define RT_USING_MUTEX           // Enable mutex usage

//#define RT_USING_EVENT           // Enable event usage

#define RT_USING_MAILBOX           // Enable mailbox usage

//#define RT_USING_MESSAGEQUEUE    // Enable message queue usage
```

## Memory Configuration

RT-Thread memory management includes memory pool, memory heap, and small memory algorithms. Enable the desired functionality by defining the corresponding macros.

```c
//#define RT_USING_MEMPOOL      // Enable memory pool usage

#define RT_USING_HEAP           // Enable memory heap usage

#define RT_USING_SMALL_MEM      // Enable small memory management

//#define RT_USING_TINY_SIZE    // Enable small-sized algorithms, related to the volume generated by rt_memset, rt_memcpy
```

## FinSH Configuration

When the FinSH component source code is added to the system, the following items need to be enabled in `rtconfig.h`.

```c
#include "finsh_config.h"
```

This header file contains configurations for the FinSH component. The following items are included in this header file:

```c
/* Enable the FinSH component */
#define RT_USING_FINSH

/* Use MSH mode */
#define FINSH_USING_MSH
#define FINSH_USING_MSH_ONLY

/* Priority and stack size of the tshell thread */
#define FINSH_THREAD_PRIORITY       21   // Check the value of the maximum system priority, which must be within the supported priority range of the system
#define FINSH_THREAD_STACK_SIZE     1024

/* Use symbol table and command description */
#define FINSH_USING_SYMTAB
#define FINSH_USING_DESCRIPTION
```

Note: If the FinSH component source code is not added, do not enable this item.

## DEVICE Framework Configuration

When the device framework source code is added to the system, the following item needs to be enabled in `rtconfig.h`.

```c
#define RT_USING_DEVICE
```

Enabling this item will include the device framework source code.

Note: If the device source code is not added, do not enable this item.

## Common Issues

Q: After completing the porting, a hard fault occurs.

A: In default settings, the stack sizes of various threads are relatively small. If the system cannot run correctly, it is likely due to insufficient stack space. Increase the stack values. For example, the default stack size of the main thread is 256, which may be insufficient when additional code is added to main. The stack of the FinSH component's tshell thread is also small (512 by default), which can be increased when needed.